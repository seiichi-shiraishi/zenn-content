---
title: "[CTF][å…¥é–€] Python3ç’°å¢ƒã‚’æ§‹ç¯‰ã—ã€PyCryptodomeã§AES encode/decode ã‚’è¡Œã†"
emoji: "ğŸ“š"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: ["CTF", "AES", pycryptodome, "python3"]
published: true
---

## ç’°å¢ƒ
- MacOS BigSur 11.6
- Visual Studio Code
- Python 3.7.7

## ç’°å¢ƒæ§‹ç¯‰
1. pycryptodomeã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¾ã™

```zsh
pip install pycryptodome
```

ä»¥ä¸‹ã®ã‚¨ãƒ©ãƒ¼ãŒå‡ºã¾ã—ãŸãŒã€ç§ã®ç’°å¢ƒã§ã¯ã€ä»¥å‰å°å…¥ã—ãŸAnacondaã¨ç«¶åˆã—ã¦ã„ã‚‹ã¿ãŸã„ã§ã—ãŸã€‚
å‚è€ƒè¨˜äº‹ã‚ˆã‚Šã€ `conda uninstall crypto` ã®ã‚³ãƒ¼ãƒ‰ã‚’å®Ÿè¡Œã™ã‚‹ã“ã¨ã§å¯¾å¿œã—ã¾ã—ãŸã€‚

:::message
ImportError: No module named Crypto.Cipher
:::

2. VSCodeã®ç’°å¢ƒè¨­å®šã«ã¦ã€Default Interpreter Path ã‚’python3ã«ã™ã‚‹
![](/images/pycrypto-1.png)

3. VSCodeã§ã‚³ãƒ¼ãƒ‰ã‚’å®Ÿè¡Œã™ã‚‹
![](/images/pycrypto-2.png)

## å®Ÿè¡Œã‚³ãƒ¼ãƒ‰
```python
import json
from base64 import b64encode, b64decode
from Crypto.Cipher import AES

header = b'header'
data = b'kyo no bangohan ha hanba-gu'
key = b'16bytes_key12345'

cipher = AES.new(key, AES.MODE_EAX)
ciphertext, tag = cipher.encrypt_and_digest(data)

json_k = [ 'nonce', 'header', 'ciphertext', 'tag' ]
json_v = [ b64encode(x).decode('utf-8') for x in (cipher.nonce, header, ciphertext, tag) ]
result = json.dumps(dict(zip(json_k, json_v)))
print(result)

b64 = json.loads(result)
jv = { k:b64decode(b64[k]) for k in json_k }

cipher_d = AES.new(key, AES.MODE_EAX, nonce=jv["nonce"])
text_d = cipher_d.decrypt_and_verify(jv['ciphertext'], jv['tag'])
print(text_d)
```
```zsh
% python3 AES.py
{"nonce": "djAXMQkMXkmNY05M69qlSg==", "header": "aGVhZGVy", "ciphertext": "XTkI3vXh3wnk110dcsIEsnuCNOtXqnJLUIpl", "tag": "0adH9gDav2DRof/iVmLkmQ=="}
b'kyo no bangohan ha hanba-gu'
```


## å‚è€ƒ
https://okumuralab.org/~okumura/python/install.html
https://qiita.com/ynakayama/items/29efebeb38604d10acef
https://www.smartbowwow.com/2018/06/pip-installuninstall.html
https://pycryptodome.readthedocs.io/en/latest/src/cipher/modern.html?highlight=encrypt_and_digest#eax-mode-1